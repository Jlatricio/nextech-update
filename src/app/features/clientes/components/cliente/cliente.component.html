  <!-- Header -->
  <div class="artigos-header text-center my-4">
    <div class="icon-circle mx-auto">
      <i class="bi bi-people-fill"></i>
    </div>
    <h3 class="mt-3">Clientes</h3>
    <button
      type="button"
        (click)="abrirModalParaCriar()"
      class="btn-hover-gradient"
    >
      Criar Cliente
      <i class="bi bi-plus-lg ms-2"></i>
    </button>
  </div>

  <!-- Filtros -->
  <main class="table table-hover" id="customers_table">
    <div class="filtros-container">
      <div class="search-group">
        <i class="bi bi-search search-icon"></i>
        <input
  type="text"
  class="search-input"
  placeholder="Pesquisar..."
  [value]="(searchTerm$ | async) || ''"
  (input)="onSearchChange($any($event.target).value)"
/>

        <i
        *ngIf="(searchTerm$ | async) as searchTerm"

          class="bi bi-x-lg clear-icon"
          (click)="onSearchChange('')"
        ></i>
      </div>

      <div class="filtros-selects">
        <div class="filtro-item">
          <div class="dropdown filtro-item" dropdown>
            <label>Tipo</label>
           <button
  dropdownToggle
  type="button"
  class="btn btn-light d-flex justify-content-between w-100 align-items-center"
>
  {{ (selectedTipo$ | async) ? getTipoClienteNome((selectedTipo$ | async) ?? '') : 'Todos' }}
  <i class="bi bi-chevron-down ms-auto"></i>
</button>

            <ul *dropdownMenu class="dropdown-menu w-100 shadow border-0">
              <li>
                <a class="dropdown-item" (click)="onTipoChange('')">Todos</a>
              </li>
              <li *ngFor="let tipo of tipos">
                <a class="dropdown-item" (click)="onTipoChange(tipo.value)">
                  {{ tipo.label }}
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>

    </div>

    <!-- Tabela de clientes -->
    <section class="table__body">
      <table class="table-hover">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Telefone</th>
            <th>E-mail</th>
            <th>Endereço</th>
            <th>Tipo</th>
            <th>Data de Criação</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientesFiltrados$ | async">
            <td>{{ cliente.nome }}</td>
            <td>{{ cliente.telefone }}</td>
            <td>{{ cliente.email }}</td>
            <td>{{ cliente.endereco }}</td>
            <td>{{ getTipoClienteNome(cliente.tipo) }}</td>
            <td>{{ cliente.dataCriacao | date: 'short' }}</td>
            <td>
              <div class="bnt-action">
               <button
  type="button"
  class="btn btn-outline-primary"
  (click)="editarCliente(cliente)">
  <i class="bi bi-pencil"></i> Editar
</button>

                <button
                  type="button"
                  class="btn btn-outline-danger"
                  (click)="deleteCliente(cliente)"
                >
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- Modal de criação/edição -->
<div class="modal fade" id="modalCliente" tabindex="-1" aria-labelledby="modalClienteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="modalClienteLabel">
            {{ editando ? 'Editar Cliente' : 'Criar Cliente' }}
          </h1>
          <button type="button" class="btn-close" (click)="fecharModal()" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <!-- Nome -->
          <div class="mb-3">
            <label for="nome" class="form-label">Nome</label>
            <input id="nome" class="form-control" type="text" formControlName="nome"
                   [class.is-invalid]="nome.touched && nome.invalid" />
            <div class="invalid-feedback" *ngIf="nome.touched && nome.invalid">
              <span *ngIf="nome.errors?.['required']">Nome é obrigatório.</span>
              <span *ngIf="nome.errors?.['minlength']">Nome deve ter ao menos 3 caracteres.</span>
            </div>
          </div>
          <!-- Email -->
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input id="email" type="email" class="form-control" formControlName="email"
                   [class.is-invalid]="email.touched && email.invalid" />
            <div class="invalid-feedback" *ngIf="email.touched && email.invalid">
              <span *ngIf="email.errors?.['required']">Email é obrigatório.</span>
              <span *ngIf="email.errors?.['email']">Formato de email inválido.</span>
            </div>
          </div>
          <!-- Telefone -->
          <div class="mb-3">
            <label for="telefone" class="form-label">Telefone</label>
            <div class="input-group">
              <span class="input-group-text">
                <img src="https://flagcdn.com/w20/ao.png" alt="Angola" width="20" height="15" />&nbsp;+244
              </span>
              <input id="telefone" type="text" class="form-control" formControlName="telefone"
                     mask="000 000 000" placeholder="Ex: 9XX XXX XXX" maxlength="9"
                     [class.is-invalid]="telefone.touched && telefone.invalid" />
              <div class="invalid-feedback" *ngIf="telefone.touched && telefone.invalid">
                <span *ngIf="telefone.errors?.['required']">Telefone é obrigatório.</span>
                <span *ngIf="telefone.errors?.['minlength']">Telefone deve ter 9 caracteres.</span>
              </div>
            </div>
          </div>
          <!-- Endereço -->
          <div class="mb-3">
            <label for="endereco" class="form-label">Endereço</label>
            <input id="endereco" type="text" class="form-control" formControlName="endereco"
                   [class.is-invalid]="endereco.touched && endereco.invalid" />
            <div class="invalid-feedback" *ngIf="endereco.touched && endereco.invalid">
              <span *ngIf="endereco.errors?.['required']">Endereço é obrigatório.</span>
            </div>
          </div>
          <!-- Tipo -->
          <div class="mb-3">
            <label for="tipo" class="form-label">Tipo de Pessoa</label>
            <select id="tipo" class="form-select" formControlName="tipo"
                    [class.is-invalid]="tipoCtrl.touched && tipoCtrl.invalid">
              <option value="" disabled>Selecione o tipo</option>
              <option *ngFor="let t of tipos" [value]="t.value">{{ t.label }}</option>
            </select>
            <div class="invalid-feedback" *ngIf="tipoCtrl.touched && tipoCtrl.invalid">
              <span *ngIf="tipoCtrl.errors?.['required']">Tipo é obrigatório.</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="fecharModal()">Cancelar</button>
        <button type="submit" class="btn btn-success" [disabled]="form.invalid || loading">
  <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
  {{ editando ? 'Atualizar' : 'Salvar' }}
</button>

        </div>
      </form>
    </div>
  </div>
</div>
