<div class="artigos-header text-center my-4">
  <div class="icon-circle mx-auto">
    <i class="bi bi-file-earmark-text"></i>
  </div>
  <h3 class="mt-3">Artigos</h3>
  <button
  type="button"
  class="btn-hover-gradient"
  data-bs-toggle="modal"
  data-bs-target="#exampleModal"
>
  Criar Artigo
  <i class="bi bi-plus-lg ms-2"></i>
</button>

</div>


<!-- btn artigo botão -->

<!-- tabela de artigos -->
<main class="table" id="customers_table">
 <div class="filtros-container">
    <div class="search-group">
  <i class="bi bi-search search-icon"></i>
  <input
    type="text"
    class="search-input"
    placeholder="Pesquisar..."
    [(ngModel)]="searchTerm"
  />
  <i
    *ngIf="searchTerm"
    class="bi bi-x-lg clear-icon"
    (click)="searchTerm = ''"
  ></i>
</div>

    <div class="filtros-selects">

      <div class="filtro-item">

 <div class="dropdown filtro-item" dropdown>
  <label>Categoria</label>
  <button
    dropdownToggle
    type="button"
    class="btn btn-light d-flex justify-content-between w-100 align-items-center"
  >
    {{ filtroNomeCategoriaSelecionada }}
    <i class="bi bi-chevron-down ms-auto"></i>
  </button>
  <ul *dropdownMenu class="dropdown-menu w-100 shadow border-0">
    <li>
      <a class="dropdown-item" (click)="selecionarCategoria('', 'Todos')">Todos</a>
    </li>
    <li *ngFor="let categoria of categorias">
      <a
        class="dropdown-item"
        (click)="selecionarCategoria(categoria.id.toString(), categoria.nome)"
      >
        {{ categoria.nome }}
      </a>
    </li>
  </ul>
</div>

      </div>


    </div>
  </div>
<div *ngIf="loading" class="loader-container">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Carregando...</span>
  </div>
</div>

<section class="table__body">
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Tipo</th>
        <th>Categoria</th>
        <th>Imposto</th>
        <th>Preço Unitário</th>
        <th>Data de Criação</th>
        <th>CriadoPor</th>
        <th>Acções</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let artigo of artigosFiltrados">

        <td>{{ artigo.nome }}</td>
        <td>{{ artigo.tipo }}</td>
        <td>{{ artigo.categoria?.nome || 'Sem categoria' }}</td>
       <td>
  <ul>
    <li *ngFor="let nome of getNomesImpostos(artigo.impostoAplicado)">
      {{ nome }}
    </li>
  </ul>
</td>

        <td>{{ artigo.preco | currency: 'Kz' }}</td>
        <td>{{ artigo.dataCriacao | date: 'dd/MM/yyyy' }}</td>
        <td>
          {{ artigo.criadoPor }}
        </td>
        <td>
         <div class="bnt-action"> <button class="btn btn-outline-primary"
        (click)="editarArtigo(artigo)">
  <i class="bi bi-pencil"></i> Editar
</button>

          <button class="btn btn-outline-danger" (click)="excluirArtigo(artigo.id)">
            <i class="bi bi-trash"></i> Eliminar
          </button></div> </td>
      </tr>
    </tbody>
  </table>
</section>
</main>
<!-- tabela de artigo -->


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">

      <h1 class="modal-title fs-5">
  {{ modalModo === 'criar' ? 'Criar Artigo' : 'Atualizar Artigo' }}
</h1>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>

    <div class="modal-body">

      <form [formGroup]="form">
        <div class="mb-3">
          <label for="nome" class="form-label">Nome do artigo <span class="text-danger">*</span></label>
             <input type="text" id="nome" name="nome" class="form-control" formControlName="nome" required />
        </div>

        <div class="mb-3">
  <label for="categoriaSelect" class="form-label">Categoria <span class="text-danger">*</span></label>
  <div class="d-flex align-items-center gap-2">
    <select id="categoriaSelect" name="categoria" class="form-select" formControlName="categoria" required>
      <option *ngFor="let cat of categorias" [value]="cat.id">{{ cat.nome }}</option>
    </select>
    <button type="button" class="btn btn-outline-primary" (click)="toggleNovaCategoria()">
      <i class="bi bi-plus-circle"></i>
    </button>
  </div>

  <!-- Campo de criar nova categoria (agora aparece logo abaixo do botão) -->
  <div class="mt-2" *ngIf="mostrarCampoNovaCategoria">
    <label for="novaCategoria" class="form-label">Nova Categoria</label>
    <div class="input-group">
      <input
        type="text"
        id="novaCategoria"
        class="form-control"
        formControlName="nome"
        [(ngModel)]="novaCategoria"
        placeholder="Digite nova categoria"
      />
      <button type="button" class="btn btn-success" (click)="adicionarCategoria()">Salvar</button>
    </div>
  </div>
</div>

<div class="mb-3">
  <label for="tipo" class="form-label">Tipo <span class="text-danger">*</span></label>
  <select id="tipo" name="tipo" class="form-select" formControlName="tipo" required>
    <option value="PRODUTO">Produto</option>
    <option value="SERVICO">Serviço</option>
    <option value="SERVICO_COM_RETENCAO_6_5">Serviço com Retenção 6,5%</option>
    <option value="ARRENDAMENTO">Arrendamento</option>
    <option value="ARRENDAMENTO_COM_RETENCAO_15">Arrendamento com Retenção 15%</option>
  </select>
</div>




       <div class="mb-3">
  <label for="imposto" class="form-label">Imposto <span class="text-danger">*</span></label>
  <select name="imposto" id="imposto" class="form-select" formControlName="imposto" required>
  <option value="0" title="Nenhum imposto será aplicado">Nenhum imposto</option>

  <optgroup label="IVA (Imposto sobre o Valor Acrescentado)">
    <option value="0.14" title="Taxa geral do IVA sobre bens e serviços">14% (taxa geral)</option>
    <option value="0.07" title="Taxa reduzida de IVA aplicável a determinados bens/serviços"> 7% (reduzida)</option>
    <option value="0.05" title="Taxa reduzida aplicável a bens da cesta básica"> 5% (cesta básica)</option>
    <option value="0.01" title="Taxa especial aplicada na Província de Cabinda"> 1% (Cabinda)</option>
  </optgroup>

  <optgroup label="Imposto Industrial">
    <option value="0.25" title="Taxa geral para empresas"> 25% (geral)</option>
    <option value="0.10" title="Atividades agrícolas e similares"> 10% (agropecuária)</option>
    <option value="0.35" title="Bancos, seguros, petróleo, telecomunicações"> 35% (setores especiais)</option>
  </optgroup>

  <optgroup label="IRT (Rendimento do Trabalho)">
    <option value="0" title="Taxas progressivas conforme faixa salarial"> Taxas progressivas</option>
    <option value="0.25" title="Grupos B e C sem retenção na fonte"> 25% (Grupos B e C)</option>
  </optgroup>

  <optgroup label="Imposto sobre Aplicação de Capitais (IAC)">
    <option value="0.15" title="Juros de crédito">15% (juros)</option>
    <option value="0.10" title="Dividendos e royalties"> 10% (dividendos)</option>
    <option value="0.05" title="Indemnizações, mercado regulamentado"> 5%</option>
  </optgroup>

  <optgroup label="Imposto Predial (IP)">
    <option value="0.005" title="Imóveis acima de 6 milhões de AKZ"> 0,5% (padrão)</option>
    <option value="0.001" title="Imóveis até 5 milhões de AKZ"> 0,1% (residencial)</option>
    <option value="0.006" title="Terrenos urbanos"> 0,6% (terrenos)</option>
    <option value="0.25" title="Rendimentos de imóveis alugados"> 25% (renda)</option>
  </optgroup>

  <optgroup label="Outros Impostos">
    <option value="0.02" title="Compra e venda de imóveis"> Sisa – 2%</option>
    <option value="0" title="Taxas variam conforme produto"> IEC – Taxas variáveis</option>
    <option value="0" title="Taxas conforme tipo e cilindrada do veículo"> IVM – Taxas variáveis</option>
    <option value="0" title="Dependente do valor e grau de parentesco"> Sucessões e Doações</option>
    <option value="0" title="Setor petrolífero, conforme legislação"> Atividades Petrolíferas</option>
    <option value="0" title="Setor mineiro, conforme legislação"> Atividades Mineiras</option>
    <option value="0" title="Taxas variáveis sobre importações"> Direitos Aduaneiros</option>
  </optgroup>
</select>
</div>

        <div class="mb-3">
          <label for="precoUnitario" class="form-label">Preço Unitário<span class="text-danger">*</span></label>
          <input
            type="text"
            id="precoUnitario"
            formControlName="precoUnitario"
            class="form-control"
            mask="separator.2"
            thousandSeparator="."
            decimalMarker=","
            prefix="Kz "
            required
          />
        </div>
        <div class="mb-3">
          <label for="descricao" class="form-label">Descrição</label>
          <textarea
            id="descricao"
            class="form-control"
            formControlName="descricao"
            maxlength="300"
            rows="3"
            [(ngModel)]="descricao"
            (input)="descricaoRestante = 300 - descricao.length"
            placeholder="Digite a descrição do artigo"
          ></textarea>
          <small class="text-muted">
            {{ descricaoRestante || 300 }} caracteres restantes
          </small>
        </div>

       <div class="mb-3">
  <button type="submit" class="btn btn-success"
        [disabled]="loading"
        (click)="modalModo === 'criar' ? salvarArtigo() : atualizarArtigo()">
  <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
  {{ modalModo === 'criar' ? 'Salvar' : 'Atualizar' }}
</button>
</div>


      </form>
