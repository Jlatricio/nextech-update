<div class="artigos-header text-center my-4">
  <div class="icon-circle mx-auto">
    <i class="bi bi-file-earmark-text"></i>
  </div>
  <h3 class="mt-3">Documentos</h3>
 <div class="dropdown mb-3">
    <button
      type="button"
      class="btn-hover-gradient"
      data-bs-toggle="dropdown"
      aria-expanded="false"
    >
      Novo Documento
      <i class="bi bi-chevron-down ms-1"></i>
    </button>

    <ul class="dropdown-menu custom-dropdown shadow-lg p-2 border-0">
      <li>
        <a class="dropdown-item d-flex align-items-center gap-2" (click)="criarDocumento('FACTURA_PROFORMA')">
          <i class="bi bi-file-earmark-text"></i> Proforma
        </a>
      </li>
      <li>
        <a class="dropdown-item d-flex align-items-center gap-2" (click)="criarDocumento('FACTURA')">
          <i class="bi bi-receipt"></i> Factura
        </a>
      </li>
      <li>
        <a class="dropdown-item d-flex align-items-center gap-2" (click)="criarDocumento('FACTURA_RECIBO')">
          <i class="bi bi-cash-stack"></i> Factura/Recibo
        </a>
      </li>
    </ul>
  </div>

</div>

<div class="container-fluid">



<!-- Abas -->
<nav class="tabs mb-3">
  <div class="tabs-wrapper">
    <div class="tab-background" [ngStyle]="{ left: indicatorLeft, width: indicatorWidth }"></div>

    <a #tab
       class="tab-link"
       [class.active]="aba === 'proformas'"
       (click)="selecionarAba('proformas', $event)">
      <i class="bi bi-file-earmark-text"></i> Proforma
    </a>

    <a #tab
       class="tab-link"
       [class.active]="aba === 'facturas'"
       (click)="selecionarAba('facturas', $event)">
      <i class="bi bi-receipt"></i> Factura
    </a>

    <a #tab
       class="tab-link"
       [class.active]="aba === 'fr'"
       (click)="selecionarAba('fr', $event)">
      <i class="bi bi-credit-card-2-back"></i> Factura/Recibo
    </a>
    <a #tab
       class="tab-link"
       [class.active]="aba === 'nota_credito'"
       (click)="selecionarAba('nota_credito', $event)">
      <i class="bi bi-arrow-counterclockwise"></i> Nota de Crédito
    </a>
  </div>
</nav>


  <!-- Tabela de documentos -->
  <main class="table" id="customers_table">
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th>Ref.</th>
            <th>Cliente</th>
            <th>Criado Por</th>
            <th>Valor</th>
            <th>Criado em</th>
            <th>Impostos</th>
            <th *ngIf="aba !== 'nota_credito'">Ação</th>
<th *ngIf="aba === 'nota_credito'">Motivo</th>
          </tr>
        </thead>
        <tbody>
<tr *ngFor="let doc of documentosFiltrados">

            <td>{{ doc.numero }}</td>
          <td>{{ doc.cliente.nome }}</td>
            <td>{{ doc.criadoPor }}</td>
            <td>{{ doc.total | currency:'Kz':'symbol':'1.2-2' }}</td>
            <td>{{ doc.dataEmissao | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ doc.totalImpostos | currency:'Kz':'symbol':'1.2-2' }}</td>
          <td *ngIf="aba !== 'nota_credito'">
  <div class="bnt-action dropdown">
    <button type="button" class="btn" (click)="openModal(doc.id)">
      <i class="bi bi-three-dots"></i>
    </button>
  </div>
</td>

<td *ngIf="aba === 'nota_credito'">
  {{ doc.motivo }}
</td>

          </tr>
        </tbody>
      </table>
    </section>
  </main>

 <!-- Modal de Ações -->
<div class="modal fade" id="modalAcoes" tabindex="-1" aria-labelledby="modalAcoesLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header border-0">
        <h5 class="modal-title w-100" id="modalAcoesLabel">Ações</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>

      <div class="modal-body">
        <!-- Botão Nota Fiscal -->
        <div class="mb-3">
          <button class="btn btn-outline-dark d-flex mx-auto align-items-center gap-2" (click)="mostrarOpcoes = !mostrarOpcoes">
            <i class="bi bi-receipt-cutoff fs-5"></i> Nota Fiscal
          </button>
        </div>

        <!-- Opções: Anulação e Retificação -->
        <div *ngIf="mostrarOpcoes" class="d-flex justify-content-center gap-4 flex-wrap animate__animated animate__fadeIn mb-4">
          <div (click)="acaoAnular(documentoSelecionadoId!)"
               class="text-center pointer p-3 shadow-sm border rounded-3 opcao-nota">
            <i class="bi bi-x-circle-fill fs-2 text-danger"></i>
            <div class="fw-semibold mt-1">Anulação</div>
          </div>

          <div (click)="acaoRectificar(documentoSelecionadoId!)"
               class="text-center pointer p-3 shadow-sm border rounded-3 opcao-nota">
            <i class="bi bi-pencil-square fs-2 text-primary"></i>
            <div class="fw-semibold mt-1">Retificação</div>
          </div>
        </div>

        <!-- Ação: Imprimir / Download -->
        <div (click)="acaoDownload(documentoSelecionadoId!)"
             class="text-center pointer p-3 shadow-sm border rounded-3 opcao-nota mx-auto" style="width: fit-content;">
          <div>
            <i class="bi bi-printer-fill fs-2 text-success me-1"></i>
            <i class="bi bi-download fs-2 text-success"></i>
          </div>
          <div class="fw-semibold mt-1">Imprimir / Download</div>
        </div>
      </div>
    </div>
  </div>
</div>
